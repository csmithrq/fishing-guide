from flask import Flask, request
from flask_restful import Resource, Api
from persistence.MongoPersistence import MongoPersistence
from pymongo import MongoClient
from pprint import pprint
import logging
import inspect
import datetime

app = Flask(__name__)
api = Api(app)
connection = MongoClient('localhost', 27017)
mongo = MongoPersistence(connection)

testHtml = '<p style="LINE-HEIGHT: normal; MARGIN: 0in 0in 10pt" class="MsoNormal" align="justify">&#13;																			<span style="font-family: Comic Sans MS">&#13;																			<font size="2">&#13;																			<b>Delta Report<br/>&#13;																			</b>&#13;																																							</font></span>&#13;																	<font color="black" size="2" face="arial">&#13;				<font id="role_document1931" face="Arial" color="#000000">&#13;					<font id="role_document1932" face="Arial" color="#000000" size="2">&#13;				<font id="role_document1933" color="#000000">&#13;																	<font color="black" size="2" id="role_document1934">&#13;																	<font color="black" size="2" face="arial" id="role_document1935">&#13;				<font id="role_document1936" face="Arial" color="#000000">&#13;					<font id="role_document1937" face="Arial" color="#000000" size="2">&#13;				<font id="role_document1938" color="#000000">&#13;																	<font color="black" size="2" id="role_document1939">&#13;																																							<font face="Comic Sans MS" size="2" id="role_document1940" color="#000000">&#13;														&#13;																			<font size="2">&#13;																			<span style="font-family: Comic Sans MS">&#13;																			By Da</span></font><font face="Comic Sans MS" size="2">ve Hurley<br/>&#13;&#160;</font></font></font></font></font></font></font></font></font></font></font></font></p>&#13;																	<p class="aolmail_gmail-MsoNormal" style="margin:0.1pt 0in;line-height:normal" align="justify">&#13;																	<span style="font-family: Comic Sans MS">&#13;																	<font size="2">&#13;																	Captain John &#13;																	Badger of &#13;																	Barbarian &#13;																	Sport &#13;																	Fishing &#13;																	continues to &#13;																	put on a &#13;																	clinic out &#13;																	of Martinez &#13;																	with the &#13;																	50th &#13;																	sturgeon on &#13;																	the boat &#13;																	within the &#13;																	past few &#13;																	weeks on <b>&#13;																	Thursday &#13;																	12-7.</b> &#13;																	They ended &#13;																	up with &#13;																	three &#13;																	slot-limit &#13;																	fish, and &#13;																	once again, &#13;																	fresh skein &#13;																	roe has been &#13;																	the ticket. &#13;																	Badger has &#13;																	been &#13;																	searching &#13;																	around for a &#13;																	group of &#13;																	fish on the &#13;																	bottom &#13;																	before &#13;																	setting &#13;																	anchor above &#13;																	them.</font></span></p>&#13;																	<p class="aolmail_gmail-MsoNormal" style="margin:0.1pt 0in;line-height:normal" align="justify">&#13;																	<b>&#13;																	<span style="font-family: Comic Sans MS">&#13;																	<font size="2">&#13;																	&#160;</font></span></b><span style="font-family: Comic Sans MS"><font size="2">Captain &#13;																	Steve &#13;																	Mitchell was &#13;																	out on &#13;																	Tuesday with &#13;																	Captain Jeff &#13;																	Carmella of &#13;																	the Samantha &#13;																	Irene out of &#13;																	Bodega Bay, &#13;																	and Carmella &#13;																	struck first &#13;																	early in the &#13;																	morning with &#13;																	a slot-limit &#13;																	sturgeon. &#13;																	Mitchell &#13;																	said, &#8220;The &#13;																	trip started &#13;																	off with a &#13;																	bang, and &#13;																	within &#13;																	minutes of &#13;																	soaking the &#13;																	rods and not &#13;																	even having &#13;																	them all &#13;																	out, we were &#13;																	hooked up. &#13;																	After &#13;																	landing the &#13;																	early &#13;																	sturgeon, I &#13;																	thought the &#13;																	bite would &#13;																	be off the &#13;																	chain, but &#13;																	the north &#13;																	wind showed &#13;																	up and shut &#13;																	down the &#13;																	bite. &#13;																	Mitchell &#13;																	will be out &#13;																	over the &#13;																	weekend, and &#13;																	he has a few &#13;																	slots on &#13;																	Saturday &#13;																	with an open &#13;																	boat on &#13;																	Monday.</font></span></p>&#13;																	<p class="aolmail_gmail-MsoNormal" style="margin:0.1pt 0in;line-height:normal" align="justify">&#13;																	<span style="font-family: Comic Sans MS">&#13;																	<font size="2">&#13;																	Benicia Bait &#13;																	and Tackle &#13;																	reported &#13;																	good &#13;																	sturgeon &#13;																	action in &#13;																	the Big Cut &#13;																	and around &#13;																	the &#13;																	Horseshoe &#13;																	with salmon &#13;																	roe. One &#13;																	boat has &#13;																	been fishing &#13;																	roe, and &#13;																	they have &#13;																	reportedly &#13;																	caught and &#13;																	released 57 &#13;																	sturgeon on &#13;																	five trips. &#13;																	Striper &#13;																	action from &#13;																	the &#13;																	shoreline &#13;																	has also &#13;																	been solid &#13;																	with grass &#13;																	shrimp, pile &#13;																	worms, or &#13;																	blood worms. &#13;																	The bullhead &#13;																	counts have &#13;																	dropped to &#13;																	only a few &#13;																	dozen per &#13;																	day after 15 &#13;																	dozen on a &#13;																	normal day. &#13;																	They have &#13;																	plenty of &#13;																	grass &#13;																	shrimp, &#13;																	ghost &#13;																	shrimp, pile &#13;																	worms, and &#13;																	blood worms &#13;																	for the &#13;																	weekend.&#13;																	</font>&#13;																	</span></p>&#13;																	<p class="aolmail_gmail-MsoNormal" style="margin:0.1pt 0in;line-height:normal" align="justify">&#13;																	<span style="font-family: Comic Sans MS">&#13;																	<font size="2">&#13;																	Clyde Wands, &#13;																	shallow &#13;																	trolling &#13;																	expert, &#13;																	showed that &#13;																	he is &#13;																	willing to &#13;																	take what &#13;																	the river &#13;																	gives him, &#13;																	and after &#13;																	trolling for &#13;																	a period &#13;																	around &#13;																	Decker &#13;																	Island and &#13;																	Broad Slough &#13;																	for a single &#13;																	striper, &#13;																	they &#13;																	switched &#13;																	over to &#13;																	slow-trolling &#13;																	live &#13;																	mudsuckers &#13;																	for 7 &#13;																	striped bass &#13;																	to 8 pounds. &#13;																	He said, &#13;																	&#8220;The river &#13;																	was so foggy &#13;																	early this &#13;																	morning that &#13;																	you couldn&#8217;t &#13;																	see the &#13;																	front of the &#13;																	boat, and &#13;																	the water &#13;																	suddenly &#13;																	turning cold &#13;																	has affected &#13;																	the troll &#13;																	bite. I &#13;																	think the &#13;																	trolling &#13;																	action will &#13;																	be back on &#13;																	next week &#13;																	when the &#13;																	fish &#13;																	acclimate.&#8221;</font></span></p>&#13;																	<p class="aolmail_gmail-MsoNormal" style="margin:0.1pt 0in;line-height:normal" align="justify">&#13;																	<span style="font-family: Comic Sans MS">&#13;																	<font size="2">&#13;																	Captain Mike &#13;																	Gravert of &#13;																	Intimidator &#13;																	Sport &#13;																	Fishing out &#13;																	of Korths &#13;																	Pirate&#8217;s &#13;																	Lair said, &#13;																	&#8220;The super &#13;																	moon and the &#13;																	colder water &#13;																	temperatures &#13;																	have added &#13;																	yet another &#13;																	curve ball &#13;																	to a season &#13;																	that has &#13;																	been the &#13;																	same song &#13;																	and dance &#13;																	throughout. &#13;																	Our &#13;																	fall/winter &#13;																	striper &#13;																	season has &#13;																	and &#13;																	continues to &#13;																	be &#13;																	&#8216;consistently &#13;																	inconsistent.&#8217; &#13;																	We had three &#13;																	trips in a &#13;																	row where we &#13;																	put in over &#13;																	100-plus &#13;																	keepers in &#13;																	and around &#13;																	the San &#13;																	Joaquin &#13;																	close to &#13;																	home, and &#13;																	then on the &#13;																	fourth trip &#13;																	&#8211; two &#13;																	keepers. How &#13;																	does this &#13;																	happen? It &#13;																	has been a &#13;																	very &#13;																	successful &#13;																	season &#13;																	overall &#13;																	since we &#13;																	started two &#13;																	and a half &#13;																	months ago, &#13;																	and we have &#13;																	been &#13;																	starting to &#13;																	make some &#13;																	left turns &#13;																	out of the &#13;																	marina &#13;																	towards the &#13;																	northeast &#13;																	Delta. The &#13;																	water &#13;																	temperatures &#13;																	have gone &#13;																	down five to &#13;																	six degrees, &#13;																	and this is &#13;																	going to be &#13;																	yet just &#13;																	another &#13;																	factor and &#13;																	hurdle to &#13;																	deal with &#13;																	over the &#13;																	next couple &#13;																	of weeks. &#13;																	Hey, if it &#13;																	were easy, &#13;																	everyone &#13;																	would do it, &#13;																	right?&#8221;<br/>&#13;																	Randy &#13;																	Pringle, the &#13;																	Fishing &#13;																	Instructor, &#13;																	was out &#13;																	during the &#13;																	blow out on &#13;																	Monday and &#13;																	Tuesday in &#13;																	the Delta, &#13;																	and he said, &#13;																	&#8220; I &#13;																	contacted my &#13;																	clients and &#13;																	tried to &#13;																	talk them &#13;																	out of going &#13;																	since I knew &#13;																	the &#13;																	conditions &#13;																	would be &#13;																	brutal, but &#13;																	they both &#13;																	insisted on &#13;																	going. My &#13;																	takeaway &#13;																	from this &#13;																	is, &#8216;When &#13;																	the guide &#13;																	says don&#8217;t &#13;																	go, you &#13;																	should take &#13;																	this into &#13;																	consideration,&#8217; &#13;																	because the &#13;																	action was &#13;																	not good at &#13;																	all. We ran &#13;																	all over the &#13;																	Delta to try &#13;																	and find &#13;																	fish, and I &#13;																	felt &#13;																	obligated to &#13;																	do my best &#13;																	for them, &#13;																	but we had &#13;																	to get out &#13;																	of the wind &#13;																	by tucking &#13;																	and hiding &#13;																	in spots &#13;																	that would &#13;																	be holding &#13;																	fish. We &#13;																	actually &#13;																	found a &#13;																	decent &#13;																	ripbait bite &#13;																	on Monday &#13;																	with the ima &#13;																	Flit in shad &#13;																	patterns, &#13;																	and this is &#13;																	because the &#13;																	largemouth &#13;																	bass are &#13;																	oriented to &#13;																	shad. We &#13;																	ended up &#13;																	with around &#13;																	15 &#13;																	largemouth &#13;																	bass and a &#13;																	single &#13;																	striper, but &#13;																	the bite on &#13;																	Tuesday was &#13;																	terrible as &#13;																	the water &#13;																	turned brown &#13;																	from the &#13;																	wind. There &#13;																	was only 3 &#13;																	inches of &#13;																	visibility &#13;																	at Sherman &#13;																	Island, and &#13;																	there were &#13;																	clouds of &#13;																	mud &#13;																	everywhere. &#13;																	The fish &#13;																	were absent, &#13;																	and I &#13;																	couldn&#8217;t &#13;																	graph them &#13;																	in any &#13;																	locations. &#13;																	Frank&#8217;s &#13;																	Tract was &#13;																	very muddy &#13;																	along with &#13;																	the San &#13;																	Joaquin from &#13;																	the Barges &#13;																	to the &#13;																	Antioch &#13;																	Bridge. The &#13;																	stripers &#13;																	were not &#13;																	present in &#13;																	any &#13;																	concentration, &#13;																	and the &#13;																	conditions &#13;																	wouldn&#8217;t &#13;																	allow for a &#13;																	swimbait or &#13;																	topwater &#13;																	bite. Spoons &#13;																	were not &#13;																	effective as &#13;																	the fish &#13;																	were not &#13;																	schooled up. &#13;																	It is four &#13;																	to six week &#13;																	late for the &#13;																	stripers to &#13;																	arrive, and &#13;																	we need rain &#13;																	to bring &#13;																	them in to &#13;																	the river &#13;																	system. &#13;																	There is &#13;																	shad all &#13;																	over the &#13;																	place, but &#13;																	it is on &#13;																	clumped up &#13;																	in bunches. &#13;																	The water &#13;																	dropped to &#13;																	the 51/52 &#13;																	degree &#13;																	range, and &#13;																	once the &#13;																	water &#13;																	temperatures &#13;																	drop below &#13;																	55 degrees, &#13;																	the shad &#13;																	will school &#13;																	up into &#13;																	tighter &#13;																	groups. When &#13;																	the shad &#13;																	schools up, &#13;																	if you find &#13;																	one bass, &#13;																	you will &#13;																	find two or &#13;																	three more. &#13;																	If the wind &#13;																	stays down &#13;																	and the &#13;																	weather &#13;																	balances &#13;																	out, we will &#13;																	move into &#13;																	our typical &#13;																	wintertime &#13;																	bite with &#13;																	ripbaits, &#13;																	plastics on &#13;																	the &#13;																	drop-shot or &#13;																	dart head. A &#13;																	Bottom &#13;																	Hopper or &#13;																	Flat Dog on &#13;																	a Zappu head &#13;																	is also &#13;																	effective in &#13;																	the colder &#13;																	water. The &#13;																	Florida-strain &#13;																	largemouth &#13;																	bass are &#13;																	used to &#13;																	clearer &#13;																	water in the &#13;																	Delta, and &#13;																	the action &#13;																	comes to a &#13;																	halt when &#13;																	the water &#13;																	gets cold &#13;																	and muddy.&#8221;<br/>&#13;																	Dan&#8217;s Delta &#13;																	Outdoors in &#13;																	Oakley &#13;																	reported a &#13;																	slowdown on &#13;																	largemouth &#13;																	bass, but &#13;																	sturgeon &#13;																	fishing has &#13;																	been solid &#13;																	north in &#13;																	Prospect &#13;																	Slough and &#13;																	also in &#13;																	Montezuma &#13;																	Slough.&#13;																	</font>&#13;																	</span></p>&#13;																	<p class="MsoNormal" style="background: white" align="justify">&#13;													<font color="black" id="role_document42">&#13;													<font face="Comic Sans MS" color="black">&#13;													<font face="Comic Sans MS" color="black" id="role_document40">&#13;&#13;													<font size="3" face="Comic Sans MS" color="black" id="role_document41">&#13;													Upcoming Events: &#13;&#13;</font></font></font>&#13;&#13;<font size="2" face="Comic Sans MS" color="black" id="role_document41">&#13;							<font face="Comic Sans MS" color="black" size="2" id="role_document40">&#13;													<br/>&#13;													</font>&#13;&#13;</font>&#13;													</font>&#13;&#13;							<font face="Comic Sans MS" color="black">&#13;							<font face="Comic Sans MS" color="black" id="role_document40">&#13;&#13;<font face="Comic Sans MS" color="black" id="role_document41">&#13;							<font face="Comic Sans MS" color="black" size="2" id="role_document42">&#13;							<b>USAFishing proudly supports the many fishery and &#13;													wildlife organizations that &#13;													benefit anglers and hunters &#13;													throughout Northern &#13;													California. </b>&#13;							</font>&#13;&#13;</font></font></font>&#13;													<b>&#13;													<font face="Comic Sans MS" size="2">&#13;													If you or your organization &#13;													needs to get the word out or &#13;													are looking to promote an &#13;													event please contact us at&#13;													<a href="mailto:fishsite@aol.com" style="text-decoration: none">&#13;													<font color="#000000">fishsite@aol.com</font></a> so we &#13;													can inform our readers.</font></b><font color="black" size="2" face="Comic Sans MS"><font face="Comic Sans MS" color="black" size="2" id="role_document"><font size="2" face="Comic Sans MS" color="black" id="role_document460"><font size="2" face="Comic Sans MS,Arial Black" color="black" id="role_document33"><font face="Comic Sans MS" size="2"><br/>&#13;&#160;</font></font></font></font></font></p>&#13;&#13;<p class="MsoNormal" align="justify">&#13;														<font face="Comic Sans MS">&#13;														<b>&#13;														<a href="http://goldengatesalmonassociation.com">&#13;														<font color="#000080" size="2">Golden Gate Salmon &#13;														Association Events &#13;														Calenda</font></a><font color="#000080" size="2">r</font></b></font></p>'

#
@app.route('/profile', methods=['GET'])
def profile():
    try:
        args = request.args
        fishNames = args['fish']
        for oneFish in fishNames.split("|"):
            fishProfiles = mongo.fetchFishProfile(oneFish)
            for profile in fishProfiles:
                return profile.fish
    except Exception as error:
        logging.error(error)
        raise

class FishingLocation(Resource):
    def get(self):
        return "Fishing Location"

@app.route('/option', methods=['GET'])
def option():
    try:
        args = request.args
        month = args['month']
        if args['month'] is None:
            options = mongo.fetchFishingOptionsByMonth()
        else:
            options = mongo.fetchFishingOptionsByMonth(month)
        for option in options:
            return option.trigger
    except Exception as error:
        logging.error(error)
        raise

@app.route('/reports', methods=['GET'])
def reports():
    reportDisplay = ""
    try:
        args = request.args
        limit = int(args['limit'])
        ids = mongo.fetchFishingReportIds(limit)
        for id in ids:
            report = mongo.fetchFishingReport(id)
            reportDisplay += '<hr>'
            reportDisplay += '<H1>' + report.location + '</H1>'+ '<br>'
            reportDisplay += '<H1>' + report.reportDate.strftime("%Y-%m-%d %H:%M:%S") + '</H1>' + '<br>'
            reportDisplay += report.reportContent
        return reportDisplay
    except Exception as error:
        logging.error(error)
        print(error)
        raise

if __name__ == "__main__":
    app.run()